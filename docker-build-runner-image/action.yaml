---
#  TODO #1 Update provenance flag on docker/build-push-action
#  TODO #2 Update sbom flag on docker/build-push-action
name: Docker Build Runner Image
description: Docker build runner image
inputs:
  docker-context:
    description: Docker context
    required: true
  dockerfile:
    description: Dockerfile
    required: true
outputs:
  image-name:
    description: Image name
    value: ${{ steps.image-name.outputs.image-name }}
runs:
  using: "composite"
  steps:
    - shell: bash
      id: image-name
      run: |
        imageName="runner-image-$(date +"%Y%m%d%H%M%S")"
        echo "image-name=$imageName" >> $GITHUB_OUTPUT

    - shell: bash
      run: |
        USER_ID=$(id -u)
        GROUP_ID=$(getent group docker | cut -d: -f3)
        docker build --build-arg USER_ID=$USER_ID --build-arg GROUP_ID=$GROUP_ID -f ${{ inputs.dockerfile }} ${{ inputs.docker-context }} --progress=plain --sbom=false --provenance=false --tag ${{ steps.image-name.outputs.image-name }}
