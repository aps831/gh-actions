---
name: Action Trivy Image Scan
description: Scan Docker image with Trivy
inputs:
  image:
    description: Image name and tag
    required: true
runs:
  using: "composite"
  steps:
    - uses: aquasecurity/trivy-action@6e7b7d1fd3e4fef0c5fa8cce1229c54b2c9bd0d8 # pin@v0.24.0
      with:
        image-ref: ${{ inputs.image }}
        format: "table"
        exit-code: "1"
        ignore-unfixed: true
        vuln-type: "os,library"
        severity: "HIGH,CRITICAL"
        output: "trivy-image-results.txt"

    - shell: bash
      if: ${{ always() }}
      run: |
        echo "**Trivy Image '${{ inputs.image }}' Scan Summary**" >> $GITHUB_STEP_SUMMARY
        echo '```text' >> $GITHUB_STEP_SUMMARY
        cat trivy-image-results.txt >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
