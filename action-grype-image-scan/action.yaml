---
name: Action Grype Image Scan
description: Scan Docker image with Grype
inputs:
  image:
    description: Image name and tag
    required: true
runs:
  using: "composite"
  steps:
    - uses: aps831/gh-actions/install-rust-tool@master
      with:
        tool: sarif-fmt

    - uses: anchore/scan-action@4e08a16a68fb1b35d2fca00f0607db0b5b5120a7 # pin@v3
      id: scan
      with:
        image: "${{ inputs.name }}"
        output-format: "sarif"
        fail-build: true

    - shell: bash
      if: ${{ always() }}
      run: |
        echo "**Grype Image '${{ inputs.image }}' Scan Summary**" >> $GITHUB_STEP_SUMMARY
        echo '```text' >> $GITHUB_STEP_SUMMARY
        cat ${{ steps.scan.outputs.sarif }} | sarif-fmt >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
